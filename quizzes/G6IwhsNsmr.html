<!DOCTYPE html>
<html>

<head>
    <!-- webページ設定 -->
    <meta charset="UTF-8">
    <title>大垣市こどもICT講座</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <!-- obniz設定 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://obniz.io/js/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/obniz@2.2.0/obniz.js"></script>
</head>

<body>
    <div class="wrapper">
        <header>
            <a href="#" id="header-text">大垣市こどもICT講座</a>
        </header>

        <main>
            <h1>
                <!-- クイズタイトル -->
                GPS
                <!-- クイズのタイトルここまで -->
            </h1>

            <!-- obnizのデバッグ情報を表示 -->
            <div id="obniz-debug"></div>

            <h2>回路図</h2>
            <p>
                <div id="explain">
                    まずは回路を組みましょう。
                    距離センサを使って、文字を入力して答えてね！
                </div>
                <div id="hosoku">
                    (※obnizがonlineじゃないと問題が答えられません！)
                </div>
                <div>
                    <button type="button" class="btn btn-primary" id="connect">obnizを接続</button>
                </div>
            </p>
            <!-- 回路図のファイル名とタイトルを記入 -->
            <img src="../image/g6_b.png" title="距離センサとスイッチのブレッドボード">
            <img src="../image/g6_c.png" title="距離センサとスイッチの回路図">

            <h2>問題</h2>
            <p>
                <!-- ここに問題を書く -->
                <div class="one">
                    GPSは「
                    <span style="color: rgb(255,0,0)">G</span>
                    lobal&nbsp;
                    <span style="color: rgb(255,0,0)">P</span>
                    ositioning&nbsp;
                    <span style="color: rgb(255,0,0)">S</span>
                    ystem」というアメリカのシステムの略語ですが、その一般名称は何でしょう？<br>
                    (※略語で答えてね！)<br>
                    <br>
                </div>
                <div class="two">
                    <!--<span style="font-size: 16pt; color: rgb(RedValue, GreenValue, BlueValue)">word</span>-->
                    距離センサに手をかざすと、アルファベットが変わるよ！
                    近い方からA、B、C…Zに対応してるんだ。<br>
                    スイッチで入力と削除ができるから、距離を変えて答えのアルファベット4文字を入力してみよう！<br>
                    <br>
                    難しいから、みんなで協力してやってみてね！！<br>
                    <br>
                    入力した文字は↓に表示されるよ。
                    <B>
                        <div id="edit_area"></div>
                    </B>

                    <!-- ここまで問題 -->
            </p>

            <!--obnizで距離を測る-->
            <!-- <div id="obniz-debug"></div> -->
            <!--<h1>距離を測ります</h1>-->


            <!--解説-->
            <span id="answer" style="visibility: hidden">
                <h2>解説</h2>
                <p>
                    <!-- ここに解説を書く -->
                    <div class="Explanation">
                        おめでとう！！
                        GPSの一般名称は
                        <span style="font-size: 16pt; color: rgb(179, 66, 74)">GNSS</span>
                        <!--えんじ色-->
                        だよ！<br>
                        「<span style="color: rgb(255,0,0)">G</span>lobal
                        <span style="color: rgb(255,0,0)">N</span>avigation
                        <span style="color: rgb(255,0,0)">S</span>atelite
                        <span style="color: rgb(255,0,0)">S</span>ystem」の略だネ。
                    </div>
                </p>
                <p>
                    <div id="Bitches">
                        でも、みんなが「GPS」って言うせいで、GPSのほうが有名になっちゃってるんだよね…。かわいそう。
                    </div>
                    <!-- ここまで解説 -->
                </p>
                <p>この問題の鍵は<span id="key">83</span> だよ！</p>
            </span>
        </main>

        <footer>
            <p>
                NIT, Gifu College | 2019
            </p>
        </footer>
    </div>



    <script>
        console.log('console check.');
        // obnizに接続
        // OBNIZ_ID_HEREにしておくと実行時にIDを聞いてくれる
        $("#connect").click(function () {
            var obniz = new Obniz("OBNIZ_ID_HERE");
            obniz.onconnect = async function () {
                var sensor = obniz.wired("GP2Y0A21YK0F", { vcc: 0, gnd: 1, signal: 2 });
                var ans = new String();

                while (1) {
                    var val = await sensor.getWait();
                    console.log("distance " + val + "mm");
                    await obniz.wait(1000);

                    var word = new String();

                    if (val <= 50) { word = "A"; }
                    else if (val <= 60) { word = "B" }
                    else if (val <= 70) { word = "C" }
                    else if (val <= 80) { word = "D" }
                    else if (val <= 90) { word = "E" }
                    else if (val <= 100) { word = "F" }
                    else if (val <= 111) { word = "G" }
                    else if (val <= 120) { word = "H" }
                    else if (val <= 130) { word = "I" }
                    else if (val <= 140) { word = "J" }
                    else if (val <= 150) { word = "K" }
                    else if (val <= 160) { word = "L" }
                    else if (val <= 170) { word = "M" }
                    else if (val <= 181) { word = "N" }
                    else if (val <= 190) { word = "O" }
                    else if (val <= 200) { word = "P" }
                    else if (val <= 210) { word = "Q" }
                    else if (val <= 220) { word = "R" }
                    else if (val <= 231) { word = "S" }
                    else if (val <= 240) { word = "T" }
                    else if (val <= 250) { word = "U" }
                    else if (val <= 260) { word = "V" }
                    else if (val <= 270) { word = "W" }
                    else if (val <= 280) { word = "X" }
                    else if (val <= 290) { word = "Y" }
                    else { word = "Z" }

                    obniz.display.clear();
                    var button = obniz.wired("Button", { signal: 4, gnd: 5 });
                    var button2 = obniz.wired("Button", { signal: 6, gnd: 7 });
                    button.onchange = function (pressed) {
                        if (pressed == true) {
                            console.log("input");
                            ans += word;
                        }
                    };
                    button2.onchange = function (pressed) {
                        if (pressed == true) {
                            console.log("delete");
                            ans = ans.slice(0, -1);
                        }
                    };
                    obniz.display.print(word);
                    obniz.display.print(ans);

                    document.getElementById('edit_area').textContent = ans;

                    if (ans == "GNSS") {
                        const answer = document.getElementById("answer");
                        answer.style.visibility = "visible";
                    }
                }
            };
        });
    </script>

</body>

</html>